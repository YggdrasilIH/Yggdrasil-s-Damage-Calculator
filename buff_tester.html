<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Battle Simulator</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f4eb; }
    pre { background: #e0dcd0; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>

<h1>Battle Simulator Skeleton</h1>
<pre id="log"></pre>

<script>
/* ------------------------
   Global Battle State
-------------------------*/
const battleState = {
  round: 1,
  heroes: [],
  lfaBuffs: {},
  boss: {
    abyssalCorruptionStacks: 0,
    HDStacks: 0,
    atkBuff: 0
  },
  lfaDebuffs: {
    curseOfDecay: { stacks: 0 }
  }
};

/* ------------------------
   Utility Functions
-------------------------*/
function tryApplyBuff(buff, targetBuffs) {
  // Curse of Decay check (only for LFA)
  if (targetBuffs === battleState.lfaBuffs &&
      battleState.lfaDebuffs.curseOfDecay.stacks > 0 &&
      buff.offsettable &&
      buff.stat !== "ADD" &&
      !buff.isSkillEffect) {
    battleState.lfaDebuffs.curseOfDecay.stacks--;
    return; // buff negated
  }

  // Non-stacking ADD logic
  if (buff.stat === "ADD" && buff.nonStacking) {
    targetBuffs[buff.stat] = { value: buff.value, duration: buff.duration };
    return;
  }

  // Normal buff stacking
  if (!targetBuffs[buff.stat]) {
    targetBuffs[buff.stat] = { value: buff.value, duration: buff.duration };
  } else {
    targetBuffs[buff.stat].value += buff.value;
    targetBuffs[buff.stat].duration = Math.max(targetBuffs[buff.stat].duration, buff.duration);
  }
}

/* ------------------------
   Hero Definitions
-------------------------*/

// SQH
const SQH = {
  name: "SQH",
  transitionPoints: 0,
  activeBuffs: [
    { stat: "abyssalCorruption", value: 1, chance: 0.25 }
  ],
  basicBuffs: [],
  DTThreshold: 12,
  DTBuffs: [
    { stat: "energy", value: 20, duration: 0, stackable: true },
    { stat: "armor", value: 0.20, duration: 2, stackable: true },
    { stat: "DR", value: 0.20, duration: 2, stackable: true },
    { stat: "atk", value: 0.10, duration: 2, stackable: true },
    { stat: "ADD", value: 0.10, duration: 2, stackable: true }
  ]
};

// Ely
const Ely = {
  name: "Ely",
  hasDT: false,
  activeBuffs: [],
  basicBuffs: []
};

// LBRM
const LBRM = {
  name: "LBRM",
  transitionPoints: 0,
  activeBuffs: [
    { stat: "ADD", value: 0.12, duration: 4, stackable: false, nonStacking: true }
  ],
  basicBuffs: [
    { stat: "ADD", value: 0.12, duration: 4, stackable: false, nonStacking: true }
  ],
  DTThreshold: 6,
  DTBuffs: [
    { stat: "HD", value: 0.10, duration: 2, stackable: true },
    { stat: "ADD", value: 0.15, duration: 2, stackable: true },
    { stat: "ADD", value: 0.10, duration: 3, stackable: true }
  ]
};

// Vespera
const Vespera = {
  name: "Vespera",
  transitionPoints: 0,
  activeBuffs: [
    { stat: "atk", value: 0.10, duration: 2, stackable: true },
    { stat: "armor", value: 0.10, duration: 2, stackable: true },
    { stat: "DR", value: 0.10, duration: 2, stackable: true },
    { stat: "CI", value: 0.10, duration: 2, stackable: true },
    { stat: "speed", value: 30, duration: 2, stackable: true }
  ],
  basicBuffs: [
    { stat: "atk", value: 0.10, duration: 2, stackable: true },
    { stat: "ADD", value: 0.08, duration: 2, stackable: true, chance: 0.8 }
  ],
  DT6Buffs: [
    { stat: "energy", value: 20, duration: 0, stackable: true },
    { stat: "atk", value: 0.10, duration: 2, stackable: true }
  ],
  DT12Buffs: [
    { stat: "energy", value: 20, duration: 0, stackable: true },
    { stat: "atk", value: 0.10, duration: 2, stackable: true },
    { stat: "ADD", value: 0.10, duration: 2, stackable: true }
  ]
};

// Register heroes
battleState.heroes.push(SQH, Ely, LBRM, Vespera);

/* ------------------------
   Example Logging
-------------------------*/
document.getElementById("log").textContent = JSON.stringify(battleState, null, 2);
</script>

</body>
</html>
