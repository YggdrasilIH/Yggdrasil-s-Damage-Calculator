<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>15-Round Battle Simulator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #121212;
    color: #e0e0e0;
    padding: 20px;
  }
  button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
  }
  pre {
    background: #1e1e1e;
    padding: 15px;
    max-height: 80vh;
    overflow-y: auto;
    white-space: pre-wrap;
    border-radius: 6px;
  }
</style>
</head>
<body>

<h1>15-Round Battle Simulator</h1>
<button onclick="runSimulation()">Run Simulation</button>
<pre id="log"></pre>

<script>
/* =========================
   GLOBAL STATE
========================= */

const logEl = document.getElementById("log");

function log(msg) {
  logEl.textContent += msg + "\n";
}

function rng50() {
  return Math.random() < 0.5;
}

/* =========================
   LFA STATE
========================= */

const LFA = {
  buffs: [],
  curseStacks: 0
};

/* =========================
   BUFF HANDLING
========================= */

function applyBuffToLFA(buff) {
  if (buff.type === "ALL_DAMAGE_DEALT") {
    LFA.buffs.push(buff);
    log(`  ✔ Buff applied (immune): ${buff.name}`);
    return;
  }

  if (LFA.curseStacks > 0) {
    LFA.curseStacks--;
    log(`  ✖ Buff negated by Curse: ${buff.name} (Curse left: ${LFA.curseStacks})`);
  } else {
    LFA.buffs.push(buff);
    log(`  ✔ Buff applied: ${buff.name}`);
  }
}

/* =========================
   HERO DEFINITIONS
========================= */

const heroes = [
  { speed: 1, name: "Vespera" },
  { speed: 2, name: "LFA" },
  { speed: 3, name: "Elyvia" },
  { speed: 4, name: "SQH" },
  { speed: 5, name: "PDE" },
  { speed: 6, name: "LBRM" }
];

/* =========================
   HERO ACTIONS
========================= */

function vesperaAction(round) {
  log(" Vespera attacks");

  // Always buffs
  [
    "10 Attack",
    "10 Damage Reduction",
    "10 Control Immunity",
    "30 Speed"
  ].forEach(name =>
    applyBuffToLFA({ name, type: "NORMAL" })
  );

  // Conditional buffs
  if (round % 2 === 1) {
    applyBuffToLFA({ name: "Attack Steal", type: "NORMAL" });
    applyBuffToLFA({ name: "All Damage Dealt", type: "ALL_DAMAGE_DEALT" });
    applyBuffToLFA({ name: "Crit Damage", type: "NORMAL" });
  } else {
    applyBuffToLFA({ name: "Crit", type: "NORMAL" });
  }

  // DB (fastest hero on attack)
  applyBuffToLFA({ name: "Energy (DB)", type: "NORMAL" });
}

function lbrmAction() {
  log(" LBRM attacks");
  applyBuffToLFA({ name: "All Damage Dealt", type: "ALL_DAMAGE_DEALT" });
}

function genericAttack(name) {
  log(` ${name} attacks`);
}

/* =========================
   TEAM 2 LOGIC
========================= */

function team2Counter() {
  if (rng50()) {
    LFA.curseStacks++;
    log(`  ⚠ Team 2 counter: +1 Curse (Total: ${LFA.curseStacks})`);
  } else {
    log("  Team 2 counter: no Curse");
  }
}

function team2Turn() {
  log(" Team 2 attacks");
  LFA.curseStacks += 2;
  log(`  ⚠ +2 Curse from Team 2 attack (Total: ${LFA.curseStacks})`);

  // Reactive buffs
  applyBuffToLFA({ name: "Crit (SQH reaction)", type: "NORMAL" });
  applyBuffToLFA({ name: "All Damage Dealt (PDE reaction)", type: "ALL_DAMAGE_DEALT" });
  applyBuffToLFA({ name: "All Damage Dealt (PDE reaction)", type: "ALL_DAMAGE_DEALT" });
  applyBuffToLFA({ name: "Holy Damage (PDE reaction)", type: "NORMAL" });
}

/* =========================
   END OF ROUND
========================= */

function endOfRoundTeam1() {
  log(" End of Round – Team 1 effects");

  // Mirror (speed 3)
  applyBuffToLFA({ name: "Energy (Mirror)", type: "NORMAL" });
  applyBuffToLFA({ name: "All Damage Dealt (Mirror)", type: "ALL_DAMAGE_DEALT" });

  // Scissors
  applyBuffToLFA({ name: "Attack (Scissors SQH)", type: "NORMAL" });
  applyBuffToLFA({ name: "Holy Damage (Scissors PDE)", type: "NORMAL" });
  applyBuffToLFA({ name: "Holy Damage (Scissors LBRM)", type: "NORMAL" });
}

function endOfRoundTeam2() {
  LFA.curseStacks += 3;
  log(` ⚠ End of Round Team 2: +3 Curse (Total: ${LFA.curseStacks})`);
}

/* =========================
   MAIN SIMULATION
========================= */

function runSimulation() {
  logEl.textContent = "";
  LFA.buffs = [];
  LFA.curseStacks = 0;

  for (let round = 1; round <= 15; round++) {
    log(`\n===== ROUND ${round} =====`);

    for (const hero of heroes) {
      switch (hero.name) {
        case "Vespera":
          vesperaAction(round);
          break;
        case "LFA":
          genericAttack("LFA");
          break;
        case "Elyvia":
          genericAttack("Elyvia");
          break;
        case "SQH":
          genericAttack("SQH");
          break;
        case "PDE":
          genericAttack("PDE");
          break;
        case "LBRM":
          lbrmAction();
          break;
      }
      team2Counter();
    }

    team2Turn();
    endOfRoundTeam1();
    endOfRoundTeam2();

    log(` Buff count: ${LFA.buffs.length}`);
    log(` Curse stacks end of round: ${LFA.curseStacks}`);
  }

  log("\n===== SIMULATION COMPLETE =====");
}
</script>

</body>
</html>
