<!DOCTYPE html>
<html>
<head>
    <title>Idle Mechanic Estimator - Hero Selection</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f1a; color: #e0e0e0; padding: 20px; }
        .setup { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; background: #161b33; padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #2f3542; }
        .hero-box { border: 1px solid #474787; padding: 10px; border-radius: 4px; background: #1a1a2e; position: relative; }
        .log { background: #000; border: 2px solid #474787; padding: 15px; height: 500px; overflow-y: auto; font-family: 'Consolas', monospace; font-size: 12px; color: #f1f2f6; }
        
        .round-head { color: #ff4757; border-bottom: 2px solid #ff4757; margin-top: 20px; font-weight: bold; font-size: 1.2em; }
        .phase-name { color: #eccc68; margin-top: 10px; font-weight: bold; text-transform: uppercase; border-left: 4px solid #eccc68; padding-left: 10px; }
        
        .nrg-badge { background: #1e90ff; color: white; padding: 1px 4px; border-radius: 3px; font-weight: bold; }
        .curse-badge { background: #747d8c; color: #ffa502; padding: 1px 4px; border-radius: 3px; font-weight: bold; border: 1px solid #ffa502; }
        
        .boss-action { color: #ff4757; font-weight: bold; background: rgba(255, 71, 87, 0.1); }
        .success { color: #2ed573; }
        
        select, button { padding: 8px; border-radius: 4px; border: 1px solid #57606f; background: #2f3542; color: white; width: 100%; margin-top: 5px; }
        button { background: #ff4757; font-weight: bold; cursor: pointer; border: none; margin-top: 15px; }
        
        .target-label { font-size: 10px; color: #ff4757; display: block; margin-top: 5px; }
        .is-target { border: 2px solid #ff4757; background: #2d142c; }
    </style>
</head>
<body>

    <h2>Battle Setup</h2>
    <div class="setup" id="heroSetup"></div>
    <button onclick="simulate()">Start 15-Round Battle</button>
    
    <div id="log" class="log"></div>

<script>
const HERO_LIST = ["LFA", "SQH", "STV", "BDSM", "FQV", "LBRM", "ELY", "HW"];
const ARTIFACTS = ["None", "Demon Bell", "Mirror", "Antlers", "Scissors"];

// Initialize UI
const setupEl = document.getElementById('heroSetup');
for(let i=1; i<=6; i++) {
    setupEl.innerHTML += `
        <div class="hero-box" id="box${i}">
            <strong>Position ${i}</strong><br>
            Hero: <select id="hero${i}">${HERO_LIST.map(h => `<option value="${h}">${h}</option>`).join('')}</select>
            Artifact: <select id="art${i}">${ARTIFACTS.map(a => `<option value="${a}">${a}</option>`).join('')}</select>
            <label class="target-label">
                <input type="radio" name="highestAtk" value="${i}" ${i===1 ? 'checked' : ''} onclick="updateTargeting()"> Highest ATK
            </label>
        </div>`;
}

function updateTargeting() {
    const selected = document.querySelector('input[name="highestAtk"]:checked').value;
    for(let i=1; i<=6; i++) {
        document.getElementById(`box${i}`).classList.toggle('is-target', i == selected);
    }
}
updateTargeting();

let heroes = [];
const logEl = document.getElementById('log');
function log(msg, cls = "") { logEl.innerHTML += `<div class="${cls}">${msg}</div>`; }

function checkCurse(hero, type, amount = "") {
    if (hero.curseLayers > 0) {
        hero.curseLayers--;
        log(`&nbsp;&nbsp;&nbsp;âœ¨ Curse: Offset ${type} ${amount}. (Layers: ${hero.curseLayers})`, "curse-offset");
        return false;
    }
    return true;
}

function simulate() {
    logEl.innerHTML = "";
    heroes = [];
    const targetPos = parseInt(document.querySelector('input[name="highestAtk"]:checked').value);
    
    for(let i=1; i<=6; i++) {
        let art = document.getElementById(`art${i}`).value;
        heroes.push({
            pos: i,
            name: document.getElementById(`hero${i}`).value,
            energy: (art === "Demon Bell" || art === "Mirror") ? 100 : 50,
            curseLayers: 0,
            artifact: art,
            isHighestAtk: (i === targetPos),
            isFrontLine: i <= 2
        });
    }

    for (let r = 1; r <= 15; r++) {
        log(`ROUND ${r}`, "round-head");

        // PART 2: Attacking Phase
        log("Part 2: Attacking Phase", "phase-name");
        // Heroes act in order (assuming spd same as pos for simplicity here, can re-add speed later)
        heroes.forEach(h => {
            log(`[${h.name}] <span class="nrg-badge">NRG: ${h.energy}</span> <span class="curse-badge">CURSE: ${h.curseLayers}</span>`);
            
            if (h.energy >= 100) {
                log(`ðŸ”¥ ${h.name} uses ACTIVE!`);
                h.energy = 0; // The Action
                
                // Step 3: Artifact Trigger (Demon Bell)
                if (h.artifact === "Demon Bell") {
                    heroes.forEach(ally => {
                        let gain = 20 + (Math.random() < 0.5 ? 10 : 0);
                        if (checkCurse(ally, "Energy", gain)) {
                            ally.energy += gain;
                            log(`&nbsp;&nbsp;&nbsp;<span class="success">âš¡ ${ally.name} +${gain} NRG (DB)</span>`);
                        }
                    });
                }
            } else {
                log(`âš”ï¸ ${h.name} uses Basic Attack.`);
                if (checkCurse(h, "Energy", "50")) h.energy += 50;
            }
        });

        // Boss Attack
        log(`ðŸ‘¾ Boss Attacks`, "phase-name");
        heroes.forEach(h => {
            if (checkCurse(h, "Energy", "10")) h.energy += 10;
        });
        heroes.forEach(h => h.curseLayers += 2); // Boss Active

        // PART 4: End of Round
        log("Part 4: End of Round", "phase-name");
        heroes.forEach(h => {
            if (h.artifact === "Mirror") {
                heroes.forEach(ally => { if (checkCurse(ally, "Energy", "15")) ally.energy += 15; });
            }
        });

        // Boss Logic
        let target = heroes.find(h => h.isHighestAtk);
        log(`ðŸŽ¯ Boss targets ${target.name} (Highest ATK)`, "boss-action");
        target.energy = Math.max(0, target.energy - 100);
        target.curseLayers += 2;
        
        heroes.forEach(h => h.curseLayers += 3); // Global EOR Curse
        logEl.scrollTop = logEl.scrollHeight;
    }
}
</script>
</body>
</html>
